# Test values for multi-application support using RepoRegistration pattern
# This file demonstrates deploying multiple repositories using repoRegistrations

# Keep namespaces as-is; they're used in templates
namespaces:
  argo: argo-workflows
  argocd: argocd
  tenant: wf-poc
  security: security
  argo-events: argo-events

# Turn off deprecated single application
argocdApplication:
  enabled: false

# Use new repoRegistrations pattern
repoRegistrations:
  - name: nextflow-hello-project
    repoUrl: https://github.com/bwalsh/nextflow-hello-project.git
    defaultBranch: main
    tenant: research-team-1
    workflowTemplateRef: nextflow-repo-runner
    
    # Artifact bucket configuration
    artifactBucket:
      hostname: https://s3.us-west-2.amazonaws.com
      bucket: calypr-nextflow-hello
      region: us-west-2
      insecure: false
      pathStyle: false
      keyPrefix: workflows/
      externalSecretPath: argo/apps/nextflow-hello-project/s3/artifacts
    
    # GitHub credentials
    githubSecretName: github-secret-nextflow-hello
    githubSecretPath: argo/apps/nextflow-hello-project/github
    
    # Access control (Fence-authenticated emails)
    adminUsers:
      - admin@research.edu
    readUsers:
      - viewer@research.edu
    
    isPublic: false

  - name: nextflow-hello-project-2
    repoUrl: https://github.com/bwalsh/nextflow-hello-project-2.git
    defaultBranch: main
    tenant: research-team-2
    workflowTemplateRef: nextflow-repo-runner
    
    # Artifact bucket configuration
    artifactBucket:
      hostname: https://s3.us-west-2.amazonaws.com
      bucket: calypr-nextflow-hello-2
      region: us-west-2
      insecure: false
      pathStyle: false
      keyPrefix: workflows/
      externalSecretPath: argo/apps/nextflow-hello-project-2/s3/artifacts
    
    # GitHub credentials
    githubSecretName: github-secret-nextflow-hello-2
    githubSecretPath: argo/apps/nextflow-hello-project-2/github
    
    # Access control (Fence-authenticated emails)
    adminUsers:
      - admin@research2.edu
    readUsers:
      - viewer@research2.edu
    
    isPublic: false

# Turn off Argo CD dependency for testing
argo-cd:
  enabled: false

# Disable ingresses for testing
ingress:
  argoWorkflows:
    enabled: false
  argocd:
    enabled: false

# Keep the adapter minimal
authzAdapter:
  replicas: 1

# No global S3 for testing (use per-repo configuration)
s3:
  enabled: false

# No events for testing
events:
  enabled: false

# No workflow templates for testing
workflowTemplates:
  createExample: false

# Ensure Argo Workflows server is up (HTTP) and controller installs
argo-workflows:
  server:
    enabled: true
    secure: false
    extraArgs:
      - --auth-mode=server
  controller:
    # Let controller manage all namespaces (or leave empty array)
    workflowNamespaces: []
    # Enable log archiving for all workflows
    workflowDefaults:
      spec:
        archiveLogs: true
