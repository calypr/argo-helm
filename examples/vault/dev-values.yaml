# Example: Local Development with Vault Dev Server
# This configuration is for local testing with Vault running in dev mode.
# DO NOT use this in production!

# Use with:
# 1. make vault-dev vault-seed  # Start Vault and seed test data
# 2. helm install argo-stack ./helm/argo-stack -f examples/vault/dev-values.yaml

externalSecrets:
  enabled: true
  installOperator: true
  
  external-secrets:
    installCRDs: true
  
  vault:
    enabled: true
    
    # For Kind cluster, use host.docker.internal to reach Docker containers
    # For other local k8s: http://localhost:8200 or http://host.k3d.internal:8200
    address: "http://host.docker.internal:8200"
    
    # Dev mode: no TLS
    # caBundleSecretName: ""
    
    auth:
      method: "kubernetes"
      mount: "kubernetes"
      role: "argo-stack"
      serviceAccountName: "eso-vault-auth"
    
    kv:
      engineVersion: 2
      defaultPathPrefix: "kv/argo"
    
    scope: "namespaced"
    namespace: "argocd"
  
  secrets:
    argocd:
      adminPasswordPath: "argocd/admin#password"
      serverSecretKeyPath: "argocd/server#secretKey"
    
    workflows:
      artifactAccessKeyPath: "workflows/artifacts#accessKey"
      artifactSecretKeyPath: "workflows/artifacts#secretKey"
    
    github:
      tokenPath: "events/github#token"
    
    perAppS3:
      nextflow-hello:
        accessKeyPath: "apps/nextflow-hello/s3#accessKey"
        secretKeyPath: "apps/nextflow-hello/s3#secretKey"
      nextflow-hello-2:
        accessKeyPath: "apps/nextflow-hello-2/s3#accessKey"
        secretKeyPath: "apps/nextflow-hello-2/s3#secretKey"

# Enable components
s3:
  enabled: true
  hostname: "minio.minio.svc.cluster.local:9000"
  bucket: "argo-artifacts"
  region: "us-east-1"
  insecure: true
  pathStyle: true

events:
  enabled: true
  github:
    enabled: true
    secret:
      create: true
      name: "github-secret"
      tokenKey: "token"
    repositories:
      - eventName: repo_push_nextflow_hello_project
        owner: bwalsh
        repository: nextflow-hello-project
        events: ["push"]
        active: true

# Other settings
namespaces:
  argo: argo-workflows
  argocd: argocd
  tenant: wf-poc
  security: security
  argo-events: argo-events

argo-cd:
  enabled: true

argo-workflows:
  server:
    enabled: true
    secure: false

authzAdapter:
  enabled: true
  image: ghcr.io/calypr/argo-helm:latest
  fenceBase: "https://calypr-dev.ohsu.edu/user"
  replicas: 1
