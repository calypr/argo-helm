
[Home](index.md) > User Guides

# Tenant Onboarding Checklist

## ðŸ“¥ Spec: RepoRegistration ingestion

1. **Input Source**  
   - `gitapp-callback` web app receives the GitHub App installation callback.  
   - The app emits validated `RepoRegistration` manifests plus the captured `installation_id`.  
   - Payloads include tenant metadata, bucket definitions, admin/read users, and public flag.

2. **Secret Materialization**  
   - Controller extracts the `artifactBucket` / `dataBucket` `externalSecretPath` values.  
   - For each path, it writes the provided credentials into Vault KV (`kv/<path>`).  
   - Secrets are versioned per project; overwrites append Vault metadata for auditing.

3. **Manifest Repository**  
   - Rendered `RepoRegistration` YAML (one file per namespace/project) is committed to a private Git repo, e.g., `git@github.com:calypr/registration-manifests.git`.  
   - Files follow `registrations/<namespace>/<name>.yaml`.  
   - Commits include automation signature and reference to the originating GitHub installation.

4. **Promotion Flow**  
   - The manifest repo is the source of truth for the controller (`make argo-stack` pulls it).  
   - ArgoCD syncs the RepoRegistration CRs into the cluster.  
   - ESO syncs Vault secrets into Kubernetes secrets referenced by the CRs.

## âœ… Step 1: Create RepoRegistration

RepoRegistration is generated by `gitapp-callback`; manual YAML is only for debugging. Ensure the spec includes:
- `repoUrl`, `defaultBranch`, `installationId`
- Optional `tenant`, bucket blocks, access lists.

## âœ… Step 2: Ensure WorkflowTemplates exist

Repositories must ship `workflows/<runner>.yaml` or equivalent Argo WorkflowTemplates expected by the controller.

## âœ… Step 3: Configure GitHub webhook

GitHub App installation handles webhook delivery to Argo Events:
```
https://events.<domain>/push
```

## âœ… Step 4: Validate namespace

Confirm the workload namespace exists:
```
kubectl get ns wf-<repo>
```

## âœ… Step 5: Push code and trigger workflow

A push to the registered branch should create an Argo Workflow visible in the UI.
